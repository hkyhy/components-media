"use strict";(self.webpackChunk_hkyhy_components_media=self.webpackChunk_hkyhy_components_media||[]).push([[746],{4050:(e,n,t)=>{t.d(n,{A:()=>i});var a={};t.r(a),t.d(a,{exSrtSrc:()=>c,exVideoSrc:()=>l});var o=t(9826),r=t(5199);const s=t.p+"static/media/ex.06831db9ceba3f580c63.mp4",c=t.p+"static/media/exa.bb7fa7e354db8087dbd9.vtt",l=s,i={name:"AliPlayer",summary:"<p>\u963f\u91cc\u4e91\u89c6\u9891\u70b9\u64adSDK</p>",api:'<table>\n<thead>\n<tr>\n<th>\u5c5e\u6027\u540d</th>\n<th>\u8bf4\u660e</th>\n<th>\u7c7b\u578b</th>\n<th>\u9ed8\u8ba4\u503c</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>playerOptions</td>\n<td>\u64ad\u653e\u5668\u8be6\u7ec6\u53c2\u6570</td>\n<td>object</td>\n<td></td>\n</tr>\n<tr>\n<td>playerOptions.source</td>\n<td>\u64ad\u653e\u5730\u5740</td>\n<td>string</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>\u5176\u4ed6\u53c2\u6570\u8bf7\u53c2\u8003 <a href="https://help.aliyun.com/zh/vod/support/faq-about-apsaravideo-player-for-web-2?spm=a2c4g.11186623.0.0.40827c32IM33AJ">\u963f\u91cc\u4e91web\u64ad\u653e\u5668\u6587\u6863</a></p>',example:{isFull:!1,className:"AliPlayer_fd6b0",style:"",list:[{title:"\u8fd9\u91cc\u586b\u5199\u793a\u4f8b\u6807\u9898",description:"\u8fd9\u91cc\u586b\u5199\u793a\u4f8b\u8bf4\u660e",code:"const { default: AliPlayer } = _AliPlayer;\nconst { useRef } = React;\nconst { Button, Space } = antd;\nconst { exSrtSrc, exVideoSrc } = _config;\n\nconst BaseExample = () => {\n  const ref = useRef();\n  return (\n    <Space direction=\"vertical\" size={32}>\n      <Button\n        onClick={() => {\n          console.log(ref.current);\n        }}\n      >\n        \u83b7\u53d6api\n      </Button>\n\n      <AliPlayer\n        ref={ref}\n        playerOptions={{\n          height: '600px',\n          width: '1000px',\n          source: exVideoSrc,\n          textTracks: [\n            {\n              kind: 'subtitles',\n              label: 'English',\n              src: exSrtSrc,\n              srclang: 'en'\n            }\n          ]\n        }}\n      />\n    </Space>\n  );\n};\n\nrender(<BaseExample />);\n\n",scope:[{name:"_AliPlayer",packageName:"@components/AliPlayer",component:o},{name:"antd",packageName:"antd",component:r},{name:"_config",packageName:"@components/AliPlayer/mock",component:a}]}]}}},1553:(e,n,t)=>{t.d(n,{A:()=>s});var a=t(7526),o=t(5199),r=t(3050);const s={name:"AliSpeech",summary:"<p>\u5bf9\u63a5\u963f\u91cc\u8bed\u97f3\u8f6c\u6362\u670d\u52a1</p>",api:"<table>\n<thead>\n<tr>\n<th>\u5c5e\u6027\u540d</th>\n<th>\u8bf4\u660e</th>\n<th>\u7c7b\u578b</th>\n<th>\u9ed8\u8ba4\u503c</th>\n</tr>\n</thead>\n</table>",example:{isFull:!1,className:"AliSpeech_0262b",style:"",list:[{title:"\u8fd9\u91cc\u586b\u5199\u793a\u4f8b\u6807\u9898",description:"\u8fd9\u91cc\u586b\u5199\u793a\u4f8b\u8bf4\u660e",code:"const { createWithRemoteLoader } = remoteLoader;\nconst { default: AliSpeech, AliSpeechRender } = _AliSpeech;\nconst { Button, Alert, Space } = antd;\nconst { useState } = React;\nconst BaseExample = createWithRemoteLoader({\n  modules: [\n    'components-core:Global@PureGlobal',\n    'components-core:Global@usePreset',\n    'components-core:InfoPage',\n    'components-core:FormInfo',\n    'components-core:Descriptions'\n  ]\n})(({ remoteModules }) => {\n  const [PureGlobal, usePreset, InfoPage, FormInfo, Descriptions] = remoteModules;\n  const { useFormModal, fields } = FormInfo;\n  const { Input } = fields;\n  const formModal = useFormModal();\n  const { ajax } = usePreset();\n  const [params, setParams] = useState(null);\n  const ajaxForm = async ({ data }) => {\n    console.log(data);\n    return {\n      data: {\n        code: 0,\n        data: { id: '111111' }\n      }\n    };\n  };\n\n  return (\n    <PureGlobal\n      preset={{\n        ajax,\n        ajaxForm,\n        apis: {\n          ossUpload: ajaxForm,\n          aliSpeech: {\n            getToken: {\n              loader: async () => {\n                return params;\n              }\n            }\n          }\n        }\n      }}\n    >\n      <InfoPage>\n        <InfoPage.Part title=\"\u5148\u5728\u8fd9\u91cc\u8bbe\u7f6etoken\">\n          <InfoPage.Part>\n            {params && (\n              <Descriptions\n                dataSource={[\n                  [{ label: 'appKey', content: params.appKey }],\n                  [\n                    {\n                      label: 'token',\n                      content: params.token\n                    }\n                  ]\n                ]}\n              />\n            )}\n          </InfoPage.Part>\n          <InfoPage.Part>\n            <Button\n              onClick={() => {\n                const formModalApi = formModal({\n                  title: '\u8bbe\u7f6etoken',\n                  size: 'small',\n                  formProps: {\n                    data: Object.assign({}, params),\n                    onSubmit: data => {\n                      setParams(data);\n                      formModalApi.close();\n                    }\n                  },\n                  children: (\n                    <FormInfo\n                      column={1}\n                      list={[<Input name=\"appKey\" label=\"appKey\" rule=\"REQ\" />, <Input name=\"token\" label=\"token\" rule=\"REQ\" />]}\n                    />\n                  )\n                });\n              }}\n            >\n              \u70b9\u51fb\u8bbe\u7f6etoken\n            </Button>\n          </InfoPage.Part>\n        </InfoPage.Part>\n        {params && (\n          <>\n            <InfoPage.Part title=\"\u666e\u901a\u793a\u4f8b\">\n              <AliSpeech\n                taskId={AliSpeech.getUUID()}\n                onCancel={() => {\n                  console.log('\u53d6\u6d88');\n                }}\n                onComplete={message => {\n                  console.log(message);\n                }}\n              />\n            </InfoPage.Part>\n            <InfoPage.Part title=\"children render\u7528\u6cd5\">\n              <AliSpeechRender\n                taskId={AliSpeech.getUUID()}\n                onCancel={() => {\n                  console.log('\u53d6\u6d88');\n                }}\n                onComplete={message => {\n                  console.log('>>>>>>>>>>>>>>>', message);\n                }}\n              >\n                {({ recording, result, change, cancel }) => {\n                  return (\n                    <Space direction=\"vertical\">\n                      {result && <Alert message={result} />}\n                      <Button onClick={change}>{recording ? '\u5f55\u97f3\u4e2d' : '\u70b9\u51fb\u5f00\u59cb'}</Button>\n                      {recording && <Button onClick={cancel}>\u53d6\u6d88</Button>}\n                    </Space>\n                  );\n                }}\n              </AliSpeechRender>\n            </InfoPage.Part>\n          </>\n        )}\n      </InfoPage>\n    </PureGlobal>\n  );\n});\n\nrender(<BaseExample />);\n\n",scope:[{name:"_AliSpeech",packageName:"@components/AliSpeech",component:a},{name:"antd",packageName:"antd",component:o},{name:"remoteLoader",packageName:"@kne/remote-loader",component:r}]}]}}},6635:(e,n,t)=>{t.d(n,{A:()=>r});var a=t(5909),o=t(5199);const r={name:"Speech",summary:"<p>\u7528\u6237\u5904\u7406\u8bed\u97f3\u8bc6\u522b\u3001\u8bed\u97f3\u8f6c\u6587\u5b57\u7b49\uff0c\u5bf9\u63a5\u963f\u91cc\u7684\u667a\u80fd\u8bed\u97f3\u4ea4\u4e92\u670d\u52a1</p>",api:"<table>\n<thead>\n<tr>\n<th>\u5c5e\u6027\u540d</th>\n<th>\u8bf4\u660e</th>\n<th>\u7c7b\u578b</th>\n<th>\u9ed8\u8ba4\u503c</th>\n</tr>\n</thead>\n</table>",example:{isFull:!1,className:"Speech_04a83",style:"",list:[{title:"\u8fd9\u91cc\u586b\u5199\u793a\u4f8b\u6807\u9898",description:"\u8fd9\u91cc\u586b\u5199\u793a\u4f8b\u8bf4\u660e",code:"const { AudioRecordButton, AudioPlayerButton, useAudioPlayer } = _Speech;\nconst { useState } = React;\nconst { Button } = antd;\n\nconst DurationButton = ({ src }) => {\n  const { getDuration } = useAudioPlayer({ src });\n  return (\n    <Button\n      onClick={() => {\n        getDuration().then(time => console.log(time));\n      }}\n    >\n      \u83b7\u53d6\u65f6\u957f\n    </Button>\n  );\n};\n\nconst BaseExample = () => {\n  const [record, setRecord] = useState(null);\n  return (\n    <>\n      <AudioRecordButton\n        onStart={() => {\n          setRecord(null);\n        }}\n        onComplete={chunks => {\n          setRecord(new Blob(chunks, { type: chunks[0].type }));\n        }}\n      />\n      {record && (\n        <>\n          <AudioPlayerButton src={record} />\n          <DurationButton src={record} />\n        </>\n      )}\n    </>\n  );\n};\n\nrender(<BaseExample />);\n\n",scope:[{name:"_Speech",packageName:"@components/Speech",component:a},{name:"antd",packageName:"antd",component:o}]}]}}},9826:(e,n,t)=>{t.r(n),t.d(n,{default:()=>h});const a={};var o=t(3050),r=t(7558),s=t(3884),c=t(8139),l=t.n(c),i=t(6418),d=t.n(i),u=t(6748),p=t.n(u),m=t(579);const h=(0,r.createWithFetch)({loading:null,loader:async()=>(await Promise.all([new Promise(((e,n)=>{if(document.head.querySelector('link[href*="aliplayer-min.css"]'))e();else{const t=document.createElement("link");t.setAttribute("href","https://g.alicdn.com/de/prismplayer/2.15.2/skins/default/aliplayer-min.css"),t.setAttribute("rel","stylesheet"),document.head.append(t),t.addEventListener("load",(()=>{e()})),t.addEventListener("error",n)}})),(0,o.getOrLoadRemote)("Aliplayer","","https://g.alicdn.com/apsara-media-box/imp-web-player/2.16.3/aliplayer-min.js")]),{Aliplayer:window.Aliplayer})})((e=>{let{className:n,data:t,getApi:o,playerOptions:r}=e;const c=(0,s.useId)().replace(/:/g,"_"),i=(0,s.useRef)(t.Aliplayer),u=(0,s.useRef)(r),h=(0,s.useRef)(),{source:g}=r;u.current=r;const y=d()(o);return(0,s.useEffect)((()=>(h.current=new i.current(Object.assign({autoplay:!1},u.current,{id:c,source:g}),(function(e){var n;if(y(e),null!==(n=u.current)&&void 0!==n&&n.seekTime){const n=p()((()=>{e.seek(u.current.seekTime),setTimeout((()=>{e.getCurrentTime()>0?document.documentElement.removeEventListener("mousemove",n,!0):document.documentElement.addEventListener("mousemove",n,!0)}),1e3)}));document.documentElement.addEventListener("mousemove",n,!0)}})),()=>{h.current&&h.current.tag&&h.current.dispose()})),[c,g,y]),(0,m.jsx)("div",{className:l()(n,a["ali-player"]),children:(0,m.jsx)("div",{id:c})})}))},7526:(e,n,t)=>{t.r(n),t.d(n,{AliSpeechRender:()=>y,default:()=>S,getApis:()=>A,getUUID:()=>u,useSpeech:()=>p});var a=t(9379),o=t(3986),r=t(5909),s=t(3050),c=t(3884),l=t(6418),i=t.n(l),d=t(1238);const u=()=>(0,d.A)().replace(/-/g,""),p=e=>{let{taskId:n,getToken:t,onChange:a}=e;const o=(0,c.useRef)(null),r=i()((async e=>{let{stream:r}=e;const s=await t();if(!s)throw new Error("\u83b7\u53d6token\u5931\u8d25");const{token:c,appKey:l}=s,i=new WebSocket("wss://nls-gateway-cn-shanghai.aliyuncs.com/ws/v1?token=".concat(c)),d=u();await new Promise((e=>{console.log("open"),i.addEventListener("open",(()=>{console.log("socket\u94fe\u63a5\u6210\u529f"),i.send(JSON.stringify({header:{message_id:d,task_id:n,namespace:"SpeechTranscriber",name:"StartTranscription",appkey:l},payload:{format:"pcm",sample_rate:16e3,max_sentence_silence:200,enable_intermediate_result:!0,enable_punctuation_prediction:!0,enable_inverse_text_normalization:!0}}))})),i.addEventListener("message",(n=>{const t=JSON.parse(n.data);"TranscriptionStarted"===t.header.name&&(console.log("start"),e()),"TranscriptionResultChanged"===t.header.name&&a&&a(t.payload),"SentenceEnd"===t.header.name&&a&&a(t.payload)}))}));const p=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}),m=p.createMediaStreamSource(r),h=p.createScriptProcessor(2048,1,1);h.onaudioprocess=function(e){const n=e.inputBuffer.getChannelData(0),t=new Int16Array(n.length);for(let a=0;a<n.length;++a)t[a]=32767*Math.max(-1,Math.min(1,n[a]));i.send(t.buffer)},m.connect(h),h.connect(p.destination),console.log("\u5f00\u59cb\u8bc6\u522b"),o.current={ws:i,taskId:n,messageId:d,scriptProcessor:h,audioInput:m,stream:r,audioContext:p,appKey:l}})),s=i()((()=>{if(!o.current)return void console.warn("\u8fde\u63a5\u5c1a\u672a\u5efa\u7acb\u6216\u8005\u5df2\u7ecf\u65ad\u5f00");const{ws:e,taskId:n,messageId:t,scriptProcessor:a,audioInput:r,audioContext:s,appKey:c}=o.current;return e.send(JSON.stringify({header:{message_id:t,task_id:n,namespace:"SpeechTranscriber",name:"StopTranscription",appkey:c}})),e.close(),a&&a.disconnect(),r&&r.disconnect(),s&&s.close(),o.current=null,{taskId:n,messageId:t}}));return{start:r,end:s}};var m=t(579);const h=["remoteModules","taskId","onComplete","onUpload","onCancel","audioName","children"],g=["result","start","complete","cancel"],y=(0,s.createWithRemoteLoader)({modules:["components-core:Global@usePreset"]})((e=>{let{remoteModules:n,taskId:t,onComplete:s,onUpload:l,onCancel:d,audioName:u,children:m}=e,g=(0,o.A)(e,h);const[y]=n,{ajax:A,apis:f}=y(),[k,S]=(0,c.useState)({}),b=(0,c.useMemo)((()=>Object.keys(k).sort(((e,n)=>e-n)).map((e=>k[e])).join("")),[k]),{start:P,end:w}=p({taskId:t,onChange:e=>{S((n=>Object.assign({},n,{[e.index]:e.result})))},getToken:async()=>{const{data:e}=await A(Object.assign({},f.aliSpeech.getToken));if(0===e.code)return e.data}}),{recording:x,start:v,stop:I}=(0,r.useAudioRecord)(),R=i()((async()=>{S([]);const{stream:e}=await v();await P({stream:e})})),B=i()((async()=>{await I(),w(),d&&d()})),C=i()((async()=>{const e=await I(),{taskId:n,messageId:t}=w(),a=new File([new Blob(e,{type:"audio/wav"})],"".concat(u||"".concat(n,"-").concat(t),".wav"),{type:"audio/wav"}),{data:o}=await("function"===typeof l?l:f.ossUpload)({file:a});0===o.code&&s&&s({taskId:n,messageId:t,result:b,audio:o.data})})),E=i()((function(){return x?C(...arguments):R(...arguments)}));return m((0,a.A)((0,a.A)({},g),{},{recording:x,result:b,start:R,cancel:B,complete:C,change:E}))})),A=e=>{const{prefix:n}=Object.assign({},{prefix:"/api"},e);return{getToken:{url:"".concat(n,"/getToken"),method:"POST"}}},f=["result","onStart","onComplete"],k=(e=>n=>(0,m.jsx)(y,(0,a.A)((0,a.A)({},n),{},{children:n=>{let{result:t,start:r,complete:s,cancel:c}=n,l=(0,o.A)(n,g);return(0,m.jsx)(e,(0,a.A)((0,a.A)({},l),{},{result:t,cancel:c,onStart:r,onComplete:s}))}})))((e=>{let{result:n,onStart:t,onComplete:s}=e,c=(0,o.A)(e,f);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(r.AudioRecordButton,(0,a.A)((0,a.A)({},c),{},{onStart:t,onComplete:s})),n&&(0,m.jsx)("div",{children:n})]})}));k.getUUID=u,k.useSpeech=p,k.AliSpeechRender=y;const S=k},5909:(e,n,t)=>{t.r(n),t.d(n,{AudioPlayerButton:()=>x,AudioPlayerRender:()=>w,AudioRecordButton:()=>A,AudioRecordRender:()=>y,useAudioPlayer:()=>b,useAudioRecord:()=>h,withAudioPlayer:()=>P,withAudioRecord:()=>g});var a=t(9379),o=t(3986),r=t(3884),s=t(5199),c=t(6418),l=t.n(c),i=t(3050),d=t(579);const u=["onComplete","onData","onStart"],p=["children"],m=["remoteModules","recording","children","start","stop"],h=e=>{const{onComplete:n,onData:t,onStart:a}=Object.assign({},e),[o,c]=(0,r.useState)(!1),i=(0,r.useRef)([]),{message:d}=s.App.useApp(),u=l()(n),p=l()(t),m=l()(a),h=l()((async()=>{const e=await window.navigator.mediaDevices.getUserMedia({audio:!0}).catch((e=>{throw d.error("\u51fa\u9519\uff0c\u8bf7\u786e\u4fdd\u5df2\u5141\u8bb8\u6d4f\u89c8\u5668\u83b7\u53d6\u5f55\u97f3\u6743\u9650"),e})),n=new window.MediaRecorder(e);i.current={stream:e,recorder:n};const t=[["start",()=>{i.current.chunks=[],m({stream:e,recorder:n})}],["dataavailable",e=>{p(e.data),i.current.chunks.push(e.data)}]];return i.current.events=t,t.forEach((e=>{let[t,a]=e;return n.addEventListener(t,a)})),n.start(1e3),c(!0),{stream:e,recorder:n}})),g=l()((async e=>{if(!e&&c(!1),!i.current)return[];const{events:n,recorder:t,stream:a,chunks:o}=i.current;return n.forEach((e=>{let[n,a]=e;return t.removeEventListener(n,a)})),a.getTracks().forEach((e=>e.stop())),i.current=null,await u(o),o})),y=l()((async()=>{o?await g():await h()}));return{recording:o,start:h,stop:g,change:y}},g=e=>n=>{let{onComplete:t,onData:r,onStart:s}=n,c=(0,o.A)(n,u);const{recording:l,start:i,stop:p,change:m}=h({onComplete:t,onData:r,onStart:s});return(0,d.jsx)(e,(0,a.A)((0,a.A)({},c),{},{recording:l,start:i,stop:p,onClick:m}))},y=e=>{let{children:n}=e;return n((0,o.A)(e,p))},A=g((0,i.createWithRemoteLoader)({modules:["components-core:LoadingButton"]})((e=>{let{remoteModules:n,recording:t,children:r,start:s,stop:c}=e,l=(0,o.A)(e,m);const[i]=n;return(0,d.jsx)(i,(0,a.A)((0,a.A)({},l),{},{children:r?r(t):t?"\u6b63\u5728\u5f55\u5236":"\u70b9\u51fb\u5f00\u59cb"}))}))),f=["src"],k=["children"],S=["playing"],b=e=>{let{src:n}=e;const[t,a]=(0,r.useState)(!1),o=(0,r.useMemo)((()=>{if(n)return new Audio(n instanceof Blob?URL.createObjectURL(n):n)}),[n]);return(0,r.useEffect)((()=>(o.addEventListener("ended",(()=>{a(!1)})),()=>{n instanceof Blob&&URL.revokeObjectURL(o.src)})),[o,n]),{playing:t,play:async()=>{o.currentTime=0,await o.play(),a(!0)},pause:()=>{o.pause(),a(!1)},getDuration:async()=>o.duration?1e3*o.duration:new Promise(((e,n)=>{o.addEventListener("loadedmetadata",(()=>{e()})),o.addEventListener("error",(e=>{n(e)}))}))}},P=e=>n=>{let{src:t}=n,r=(0,o.A)(n,f);const{playing:s,play:c,pause:l}=b({src:t});return(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(e,(0,a.A)((0,a.A)({},r),{},{playing:s,onClick:()=>{s?l():c()}}))})},w=P((e=>{let{children:n}=e;return n((0,o.A)(e,k))})),x=P((e=>{let{playing:n}=e,t=(0,o.A)(e,S);return(0,d.jsx)(s.Button,(0,a.A)((0,a.A)({},t),{},{children:n?"\u6b63\u5728\u64ad\u653e...":"\u70b9\u51fb\u64ad\u653e"}))}))}}]);
//# sourceMappingURL=746.7d62d2ca.chunk.js.map